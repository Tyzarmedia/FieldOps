<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#f97316" />
    <title>Britelink Field Operations</title>
    <link rel="manifest" href="/manifest.json" />
    <style>
      /* Full screen styles for mobile */
      @media (max-width: 768px) {
        html,
        body {
          height: 100vh;
          height: 100dvh; /* Dynamic viewport height for mobile */
          overflow: hidden;
        }
        #root {
          height: 100vh;
          height: 100dvh;
          overflow-y: auto;
        }
      }

      /* Remove browser chrome on mobile when in standalone mode */
      @media (display-mode: standalone) {
        body {
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
      }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <script>
      // Full screen functionality for mobile devices
      function isMobile() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent,
        );
      }

      function isStandalone() {
        return (
          window.matchMedia("(display-mode: standalone)").matches ||
          window.navigator.standalone ||
          document.referrer.includes("android-app://")
        );
      }

      // Request full screen on mobile devices
      if (isMobile() && !isStandalone()) {
        // Add install prompt
        let deferredPrompt;

        window.addEventListener("beforeinstallprompt", (e) => {
          e.preventDefault();
          deferredPrompt = e;

          // Show custom install banner after 3 seconds
          setTimeout(() => {
            if (deferredPrompt && !localStorage.getItem("installPromptShown")) {
              const installBanner = document.createElement("div");
              installBanner.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; background: #f97316; color: white; padding: 12px; text-align: center; z-index: 10000; font-family: system-ui;">
                  <div style="margin-bottom: 8px;">Install Britelink app for full screen experience</div>
                  <button onclick="installApp()" style="background: white; color: #f97316; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 8px; font-weight: bold;">Install</button>
                  <button onclick="dismissInstall()" style="background: transparent; color: white; border: 1px solid white; padding: 8px 16px; border-radius: 4px;">Later</button>
                </div>
              `;
              document.body.appendChild(installBanner);

              window.installApp = () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                  deferredPrompt = null;
                  document.body.removeChild(installBanner);
                  localStorage.setItem("installPromptShown", "true");
                });
              };

              window.dismissInstall = () => {
                document.body.removeChild(installBanner);
                localStorage.setItem("installPromptShown", "true");
              };
            }
          }, 3000);
        });
      }

      // Hide address bar on mobile by scrolling
      if (isMobile()) {
        window.addEventListener("load", () => {
          setTimeout(() => {
            window.scrollTo(0, 1);
          }, 0);
        });
      }
    </script>
    <script type="module" src="/client/main.tsx"></script>
  </body>
</html>
